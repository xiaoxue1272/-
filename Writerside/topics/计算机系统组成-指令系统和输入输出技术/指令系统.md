# 指令系统


## 构成
指令, 又称机器指令, 是指示计算机执行某种操作的命令, 是**计算机运行的最小单位**

一台计算机的所有指令集合构成该计算机的指令系统, 又称**指令集**

## 格式
一条指令就是机器语言的一个语句, 它是一串有意义的二进制数据

一条指令通常要包括**操作码字段**和**地址码字段**两个部分

![指令格式(操作码&地址码).png](指令格式(操作码&地址码).png)

操作码: 指明要操作的类型  
地址码: 主要指明操作数及运算结果的存放地址

#### 地址码的七种寻址方式
**寻找指令中操作数的有效地址的方式被称为寻址方式**

* 立即寻址: 操作数作为指令的一部分直接写在指令中, 这中操作数呗称为**立即数**
* 寄存器寻址: 指令所需要的操作数存在某个寄存器中, 或把目标操作数存入寄存器中
* 直接寻址: 指令所需要的操作数存放在内存中, 在指令中直接给出该操作数的有效地址
* 寄存器间接寻址: 操作数存放在存储器中, 操作数有效地址用SI, DI, BX, BP四个寄存器之一来指定
* 寄存器相对寻址: 操作数存放在存储器中, 其有效地址是一个基址寄存器或变址寄存器中的内容 和 指令中的8位/16位偏移量之和
* 基址加变址寻址: 操作数存放在存储器中, 其有效地址是一个基址寄存器 + 一个变址寄存器的内容之和
* 相对基址加变址寻址: 操作数在存储器中, 其有效地址是一个基址寄存器的值, 一个变址寄存器的值和指令中的8位/16位偏移量之和

## CISC(复杂指令集计算机) VS RISC(精简指令集计算机)

|          | CISC(complex) | RISC(Reduced)  |
|:--------:|:-------------:|:--------------:|
|   指令系统   |    复杂, 庞大     |     简单, 精简     |
|   指令数目   |   一般大于200条    |    一般小于100条    |
|   指令字长   |      不固定      |       固定       |
|  可访存指令   |     不加限制      | 只有Load/Store指令 |
| 各种指令执行时间 |     相差较大      |  绝大多数一个周期内完成   |
| 各种指令使用频度 |     相差较大      |     都比较常用      |
| 通用寄存器数量  |      较少       |       多        |
|   控制方式   |  绝大多数为微程序控制   |  绝大多数为组合逻辑控制   |
|  指令流水线   |  可以通过一定方式实现   |      必须实现      |

## 指令的流水处理

有三种指令控制方式:  
**顺序方式 重叠方式 流水方式**

![指令流水控制图.png](指令流水控制图.png)

#### 指令流水计算

##### 执行时间

**流水线计算公式为: 1条指令的执行时间 + (指令条数 - 1) * 流水线周期**
**流水线周期为执行时间最长的一段**

例: 如果流水线将一条指令拆解为 取指 分析 执行三个部分, 且时间分别是 2ns, 2ns, 1ns  
那么流水线周期是多少?100条指令全部执行完毕所需要的时间是多少?

![指令流水计算图.png](指令流水计算图.png)

答:  
根据上述公式可得  
流水线周期 = 2ns  
1条指令执行时间 = 2ns + 2ns + 1ns = 5ns  
带入公式可得: 5ns + 99 * 2ns = 203ns

##### 吞吐率

流水线的吞吐率(Though Put rate)是指在单位时间内流水线所完成的任务数量或输出的结果数量

计算流水线的基本公式如下:

TP = 指令条数 / 流水线执行时间

##### 加速比
同样完成一批任务, **不使用流水线** 和 **使用流水线**所完成的时间之比就成为**流水线的加速比(S)**  
计算流水线的加速比基本公式如下:

S = 不使用流水线执行时间 / 使用流水线执行时间